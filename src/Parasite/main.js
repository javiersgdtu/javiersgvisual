var scrolly=d3.select(".part-3"),figure=scrolly.select(".chart"),article=scrolly.select(".bars-text-0"),step=article.selectAll(".step"),housesvg=figure.select(".container-svg").select("#house-svg"),scroller=scrollama(),scroller_heat=scrollama();function handleStepEnter(t){var e="down"==t.direction?0:1,a="down"==t.direction?"visible":"hidden",s="down"==t.direction;if(1==t.index)figure.select(".background-img").transition().duration(3e3).style("opacity",e),figure.select(".container-svg").transition().duration(1e3).style("opacity",+!e);else if(2==t.index){var r=housesvg.select("g").select("#living_room"),o=housesvg.select("g").selectAll("#basement,#cave");r.transition().duration(1e3).style("stroke-width","10px").style("opacity",1).transition().delay(1e3).duration(1e3).style("stroke-width","0.5px").style("opacity",.5),o.transition().delay(2e3).duration(1e3).style("stroke-width","10px").style("opacity",1).transition().delay(1e3).duration(1e3).style("stroke-width","0.5px").style("opacity",.5),d3.select("#area").remove(),d3.select("#house-svg").append("text").attr("id","area").text("Living Room").attr("text-anchor","middle").attr("x",posX+100).attr("y",100).transition().delay(2e3).text("Basement & Bunker").transition().delay(3e3).remove(),housesvg.select("#legend-force").style("visibility","hidden"),housesvg.select(".text-legend").style("visibility","hidden")}else 3==t.index?(housesvg.select("#legend-force").style("visibility","visible"),housesvg.select(".text-legend").style("visibility","visible"),housesvg.select(".force").style("visibility","hidden"),housesvg.select(".character-circles").style("visibility","hidden")):4==t.index?(forceCharacters(1),housesvg.select(".force").style("visibility","visible"),housesvg.select(".character-circles").style("visibility","visible"),figure.select(".switch").style("visibility","hidden"),housesvg.select("#house-heat").style("visibility","hidden"),figure.select(".house-map").style("visibility","hidden"),housesvg.select(".house-map").style("visibility","hidden"),figure.select("#sliderCheck").attr("checked",!1),figure.select("#sliderCheck").attr("checkedStory",!1),handleCheck(figure.select("#sliderCheck").node())):5==t.index&&(figure.select(".switch").style("visibility",a),figure.select("#sliderCheck").attr("checked",s),figure.select("#sliderCheck").attr("checkedStory",s),handleCheck(figure.select("#sliderCheck").node()),housesvg.select("#house-heat").style("visibility",a),figure.select(".house-map").style("visibility",a),housesvg.select(".house-map").style("visibility",a))}function init(){scroller.setup({step:".step",offset:.5,debug:!1}).onStepEnter(handleStepEnter)}init(),srcset="images/parasite.jpg 3x";var f=d3.format(".1f"),rect=d3.select("#mask").selectAll("rect").on("mouseover",handleMouseOver).on("mouseout",handleMouseOut);rect.transition().duration(2e3).delay((function(t,e){return 300*e})).style("opacity",0);var ellipse=d3.select("#mask").selectAll("ellipse").on("mouseover",handleMouseOver).on("mouseout",handleMouseOut);ellipse.transition().duration(2e3).delay((function(t,e){return 400*e})).style("opacity",0);var title=d3.select(".mask-poster").select("svg").append("text").attr("x",520).attr("y",500).attr("opacity",0).text("Highs and lows: On class and space in").attr("font-family","parasite").attr("font-size",20),text=d3.select(".mask-poster").select("svg").append("text").attr("x",450).attr("y",590).attr("opacity",0).text("PARASITE").attr("font-family","parasite").attr("font-size",100);title.transition().duration(2e3).delay(2e3).style("opacity",1),text.transition().duration(2e3).delay(2500).style("opacity",1),d3.select("#path3751-5-4-1-9-6-3").transition().duration(1e3).delay(2e3).style("opacity",.5);var cx=+f(d3.select("#path3751-5-4-1-9-6-3").attr("cx")),cy=+f(d3.select("#path3751-5-4-1-9-6-3").attr("cy"));d3.select(".mask-poster").select("svg").append("text").attr("id","arrow").html("&darr;").style("opacity",0).attr("x",cx-12).attr("y",cy+10).transition().duration(1e3).delay(2e3).attr("font-weight",40).attr("font-size",30).style("opacity",1);var title1=d3.select("#title-1"),title2=d3.select("#title-2"),title3=d3.select("#tittle-3"),title4=d3.select("#title-4"),x_t2=(cx=+f(title1.attr("cx")),cy=+f(title1.attr("cy")),+f(title2.attr("x"))),y_t2=+f(title2.attr("y")),width_t2=+f(title2.attr("width")),height_t2=+f(title2.attr("height")),x_t3=+f(title3.attr("x")),y_t3=+f(title3.attr("y")),width_t3=+f(title3.attr("width")),height_t3=+f(title3.attr("height")),cx_t2=+f(title4.attr("cx")),cy_t2=+f(title4.attr("cy"));function handleMouseOver(){d3.select(this).style("fill","white").style("opacity",.5),"title-1"==d3.select(this).attr("id")?d3.select("#text-title-1").style("opacity",1):"title-2"==d3.select(this).attr("id")?d3.select("#text-title-2").style("opacity",1):"tittle-3"==d3.select(this).attr("id")?d3.select("#text-tittle-3").style("opacity",1):"title-4"==d3.select(this).attr("id")?d3.select("#text-title-4").style("opacity",1):"path3751-5-4-1-9-6-3"==d3.select(this).attr("id")&&d3.select("#arrow").transition().duration(500).attr("font-size",40)}function handleMouseOut(){d3.select(this).transition().duration(200).style("opacity",0),d3.select("#text-"+d3.select(this).attr("id")).style("opacity",0),"path3751-5-4-1-9-6-3"==d3.select(this).attr("id")&&d3.select("#arrow").transition().duration(500).style("opacity",0).remove()}d3.select(".mask-poster").select("svg").append("text").attr("id","text-title-1").attr("x",cx-15).attr("y",cy+10).text("A").attr("font-family","argentum").attr("fill","white").attr("font-weight",20).attr("font-size",12).style("opacity",0),d3.select(".mask-poster").select("svg").append("text").attr("id","text-title-2").attr("x",x_t2+width_t2/2-25).attr("y",y_t2+height_t2/2).text("Film by").attr("font-family","argentum").attr("fill","white").attr("font-size",12).style("opacity",0),d3.select(".mask-poster").select("svg").append("text").attr("id","text-tittle-3").attr("x",x_t3+width_t3/2-100).attr("y",y_t3+height_t3/2).text("Bong Joon-Ho").attr("font-family","argentum").attr("fill","white").attr("font-size",12).style("opacity",0),d3.select(".mask-poster").select("svg").append("text").attr("id","text-title-4").attr("x",cx_t2-35).attr("y",cy_t2+10).text("Trailer").attr("font-family","argentum").attr("fill","white").attr("font-size",12).attr("font-weight","1000").style("opacity",0);var width=d3.select("#house-svg").attr("width")/2,height=d3.select("#house-svg").attr("height")/2,widthLong=1250,posX=widthLong/2,formatMinute=d3.format(".0f"),currentValue=0,moving=!1,svg=d3.select("#house-svg");d3.select(".container").style("opacity",0);var sel=d3.select("#house-color").selectAll("g").filter((function(){return null!=d3.select(this).attr("id").match("arrow-")}));d3.select("#house-color").selectAll("polygon").style("opacity",0);var opacity_temp,tooltip=d3.select(".container-svg").append("div").attr("class","tooltip");title=svg.append("text").attr("x",posX).attr("y",70).text("PARASITE").attr("font-family","parasite").attr("font-size",40);d3.selectAll("path").style("opacity",.5).on("mouseover",handleMouseOverRoom).on("mouseout",handleMouseOutRoom),d3.selectAll("#da_hye_s_room,#first_floor-corridor,#da_song_s_room,#mr__mrs_park_room").attr("class","first"),d3.selectAll("#kitchen,#garden,#living_room,#entrance,#secondary_garden").attr("class","zero"),d3.selectAll("#garage,#entrance-street,#basement,#cave,#entrance-intercom").attr("class","street-under"),svg.append("text").attr("class","house-map").attr("x",1320).attr("y",450).text("HOUSE MAP").attr("font-family","parasite").attr("font-size",20);var opacity_arr,inputElems=d3.selectAll("input");function handleMouseOverRoom(){opacity_temp=d3.select(this).style("opacity"),d3.select(this).transition().duration(500).style("stroke-width","10px").style("opacity",1),d3.select("#area").remove();var t=d3.select(this).select("title"),e=d3.select(this.parentNode).select("title");null!=e.text().match("Stairs|Intercom|Kitchen|Street")&&d3.select(this.parentNode).selectAll("polygon").transition().duration(1e3).style("opacity",1),d3.select("#house-svg").append("text").attr("id","area").text((function(a){return null==e.text().match("Stairs|Intercom|Kitchen|Street")?t.text():e.text()})).attr("text-anchor","middle").attr("x",posX+100).attr("y",100)}function handleMouseOutRoom(){var t=d3.select("#sliderCheck").node().checked,e=d3.select(this).attr("checkbox");d3.select(this).transition().duration(500).style("stroke-width","0.5px").style("opacity",(function(){return 1==e?1:1==t?opacity_temp:.5})),null!=d3.select(this.parentNode).select("title").text().match("Stairs|Intercom|Kitchen|Street")&&d3.select(this.parentNode).selectAll("polygon").transition().duration(1e3).style("opacity",0),d3.select("#area").remove()}inputElems.on("change",(function(t){var e=svg.selectAll("."+d3.select(this).attr("id")),a=e.attr("checkbox")||0,s=e.style("opacity");1!=s&&(opacity_arr=e.nodes().map((function(t){return+d3.select(t).style("opacity")}))),e.attr("checkbox",(function(){return 1!=a?1:0})).style("opacity",(function(t,e){return 1==s?opacity_arr[e]:1}))}));var node,legend,textmouseover=["Following a friend’s referral, <span class='characterText KiWoo' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Kim Ki Woo </span> arrives at the Parks’ House with a fake English diploma. He plans to become the English teacher of  <span class='characterText DaHye' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Da Hye </span>,  the daughter of the wealthy Park family. </br> He is received by <span class='characterText MoonGwang' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Moon Gwang </span> the loyal housekeeper who guides him into the impressive building. In this first scene, we also meet Mrs. Park, <span class='characterText YeonKyo' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Yeon Kyo </span>,and her two children. </br>After a successful English class trial, <span class='characterText KiWoo' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Ki Woo </span> is hired. At the end of the scene, <span class='characterText YeonKyo' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Yeon Kyo </span> chats with him about the artistic skills of <span class='characterText DaSong' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Da Song </span>, her son. On his way out, <span class='characterText KiWoo' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Ki Woo </span> proposes to her to contact an art teacher that could boost Da Song’s potential. The deception starts growing.","<span class='characterText KiWoo' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Ki Woo </span> brings his sister <span class='characterText KiJung' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Ki Jung </span> to Parks’ house to play as an art teacher called Jessica. After her trial class, she convinces <span class='characterText YeonKyo' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Yeon Kyo </span> to hire her as an art therapy teacher to help <span class='characterText DaSong' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Da Song </span> overcome his childhood traumas. Meanwhile, <span class='characterText DaHye' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Da Hye </span> and <span class='characterText KiWoo' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Ki Woo </span> start flirting during the English class.</br> At the end of the scene, <span class='characterText MrPark' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Mr. Park </span>, the busy family business man, is introduced and offers to bring Jessica home with a ride from the family chauffeur. On her way back, she leaves her underwear in <span class='characterText MrPark' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Mr. Park </span>’s car.","<span class='characterText MrPark' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Mr. Park </span> discovers Jessica’s underwear under the seat of his car and thinks that his chauffeur is having sexual encounters there. He discusses it with  <span class='characterText YeonKyo' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Yeon Kyo </span> in <span class='placesText kitchen' onmouseover='handleMouseOverTextRoom(this)' onmouseout='handleMouseOutTextRoom(this)'> the Kitchen</span> while <span class='characterText KiJung' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Ki Jung </span> listens in on the conversation from <span class='placesText entrancestairs' onmouseover='handleMouseOverTextRoom(this)' onmouseout='handleMouseOutTextRoom(this)'>the stairway of the second floor</span>. </br> As Ki Jung exits the house,  <span class='characterText YeonKyo' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Yeon Kyo </span>  mentions to her that the old chauffeur has been fired.<span class='characterText KiJung' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'> Ki Jung </span> seizes the opportunity to recommend a new chauffeur: her father, <span class='characterText KiTaek' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Ki Taek </span>.","Only one of the Kims, <span class='characterText ChungSook' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Chung Sook </span>, is left to be included in the Parks’ house hoax. </br>To do so, they have to find the way of firing <span class='characterText MoonGwang' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Moon Gwang </span>, the loyal housekeeper. During an English class, <span class='characterText DaHye' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Da Hye </span> confesses to <span class='characterText KiWoo' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Ki Woo </span> about the forbidden fruit in the house: peaches. <span class='characterText MoonGwang' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Moon Gwang </span> has extreme allergic reactions to them. This revelation triggers a coordinated family plot to make <span class='characterText YeonKyo' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Yeon Kyo </span> believe that the housekeeper has Tuberculosis.They expose <span class='characterText MoonGwang' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Moon Gwang </span> to  peach fuzz  and she ends up with an allergic reaction  that brings her to the hospital. </br>This scene reaches a climax  when <span class='characterText YeonKyo' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Yeon Kyo </span> and <span class='characterText KiTaek' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Ki Taek </span> arrive home and discover a “blood-stained” napkin in the trash. <span class='characterText MoonGwang' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Moon Gwang </span> is fired and <span class='characterText ChungSook' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Chung Sook </span> replaces her as housekeeper.","Everything seems to be going well for the Kims. Their scam has led the whole family  to be employed by the Parks.  </br>The Parks decide to go camping and leave the house under the supervision of <span class='characterText ChungSook' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Chung Sook </span>. This is the perfect excuse for the Kims to live as if they were the owners of the house for a night. During a long conversation in <span class='placesText livingroom' onmouseover='handleMouseOverTextRoom(this)' onmouseout='handleMouseOutTextRoom(this)'>the living room</span>, they drink, fantasize and reflect on their reality.</br> Suddenly someone pushes the intercom button.","<span class='characterText MoonGwang' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Moon Gwang </span>, the fired housekeeper, has returned to the house. She wants to pick up something that she has forgotten in the <span class='placesText basement' onmouseover='handleMouseOverTextRoom(this)' onmouseout='handleMouseOutTextRoom(this)'>basement</span>. </br>In this scene, we discover the <span class='placesText bunker' onmouseover='handleMouseOverTextRoom(this)' onmouseout='handleMouseOutTextRoom(this)'>bunker</span> under the basement where <span class='characterText MoonGwang' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Moon Gwang </span> has been hiding her husband <span class='characterText GeunSe' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Geun Se</span> for a long time. In a plot twist, the Kims are exposed and become the hostages of <span class='characterText MoonGwang' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Moon Gwang </span> and <span class='characterText GeunSe' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Geun Se</span>. After a fierce fight in <span class='placesText livingroom' onmouseover='handleMouseOverTextRoom(this)' onmouseout='handleMouseOutTextRoom(this)'>the living room</span> there is a sudden call: the Parks have cancelled their camping plans because of the rain. They will arrive home in 8 minutes and they want <a href='https://food52.com/blog/25002-what-is-ram-don'  target='_blank'>Ram-Don</a>.</br> The Kims get their act together and lock <span class='characterText GeunSe' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Geun Se</span> and <span class='characterText MoonGwang' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Moon Gwang </span> in the basement. After a quick cleaning, <span class='characterText KiTaek' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Ki Taek </span>, <span class='characterText KiJung' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Ki Jung </span> and <span class='characterText KiWoo' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Ki Woo </span> hide under <span class='placesText livingroom' onmouseover='handleMouseOverTextRoom(this)' onmouseout='handleMouseOutTextRoom(this)'>the living room’s</span> table while <span class='characterText YeonKyo' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Yeon Kyo </span> and <span class='characterText MrPark' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Mr. Park </span> sleep on the couch, watching over <span class='characterText DaSong' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Da Song </span> who has decided to camp in the <span class='placesText garden' onmouseover='handleMouseOverTextRoom(this)' onmouseout='handleMouseOutTextRoom(this)'>garden</span> overnight.  In the middle of the night, the Kims manage to escape and return to their flooded house.","The Parks celebrate <span class='characterText DaSong' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Da Song </span> birthday in the <span class='placesText garden' onmouseover='handleMouseOverTextRoom(this)' onmouseout='handleMouseOutTextRoom(this)'>garden</span>. <span class='characterText GeunSe' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Geun Se</span> sparks chaos when he escapes from <span class='placesText bunker' onmouseover='handleMouseOverTextRoom(this)' onmouseout='handleMouseOutTextRoom(this)'> the bunker</span> and avenges the death of his wife. The party turns into a battle field with several casualties. As a result, <span class='characterText KiTaek' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Ki Taek </span> is forced to escape after stabbing <span class='characterText MrPark' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Mr. Park </span>.","In the epilogue, we see how <span class='characterText KiTaek' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Ki Taek </span> has become the new inhabitant of the <span class='placesText bunker' onmouseover='handleMouseOverTextRoom(this)' onmouseout='handleMouseOutTextRoom(this)'>bunker</span>. In the last minutes, <span class='characterText KiWoo' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Ki Woo </span> fantasizes about getting rich to buy the house and reunite his family. In the last scene <span class='characterText KiWoo' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Ki Woo </span>, <span class='characterText ChungSook' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Chung Sook </span> and <span class='characterText KiTaek' onmouseover='textmouseOver(this)' onmouseout='textmouseOut(this)'>Ki Taek </span> hug in the <span class='placesText garden' onmouseover='handleMouseOverTextRoom(this)' onmouseout='handleMouseOutTextRoom(this)'>garden</span>. The moment fades away and reality hits again."],Characters=[{Character:"Ki Woo",Family:"Kim",Description:null,Actor:"Woo-sik Choi",Role:"English Teacher",urlImage:"https://github.com/javiersgdtu/javiersgvisual/blob/master/assets/img/characters-scale/Ki%20Woo.png?raw=true",Color:" rgb(255, 127, 0)",id:"Ki_Woo"},{Character:"Ki Jung",Family:"Kim",Description:null,Actor:"So-dam Park",Role:"Art Teacher",urlImage:"https://github.com/javiersgdtu/javiersgvisual/blob/master/assets/img/characters-scale/Ki%20Jung.png?raw=true",Color:"rgb(253,191,111)",id:"Ki_Jung"},{Character:"Ki Taek",Family:"Kim",Description:null,Actor:"Kang-ho Song",Role:"Chauffeur",urlImage:"https://github.com/javiersgdtu/javiersgvisual/blob/master/assets/img/characters-scale/Ki%20Taek.png?raw=true",Color:"rgb(227,26,28)",id:"Ki_Taek"},{Character:"Chung Sook",Family:"Kim",Description:null,Actor:"Hye-jin Jang",Role:"Housekeeper",urlImage:"https://github.com/javiersgdtu/javiersgvisual/blob/master/assets/img/characters-scale/Chung%20Sook.png?raw=true",Color:"#ff9999",id:"Chung_Sook"},{Character:"Yeon Kyo",Family:"Park",Description:null,Actor:"Yeo-jeong Jo",Role:"Mother",urlImage:"https://github.com/javiersgdtu/javiersgvisual/blob/master/assets/img/characters-scale/Yeon%20Kyo.png?raw=true",Color:"rgb(106,61,154)",id:"Yeon_Kyo"},{Character:"Mr. Park",Family:"Park",Description:null,Actor:"Sun-kyun Lee",Role:"Father",urlImage:"https://github.com/javiersgdtu/javiersgvisual/blob/master/assets/img/characters-scale/Mr.Park.png?raw=true",Color:"rgb(202,178,214)",id:"Mr._Park"},{Character:"Da Hye",Family:"Park",Description:null,Actor:"Ji-so Jung",Role:"Daughter",urlImage:"https://github.com/javiersgdtu/javiersgvisual/blob/master/assets/img/characters-scale/Da%20Hye.png?raw=true",Color:"rgb(31,120,180)",id:"Da_Hye"},{Character:"Da Song",Family:"Park",Description:null,Actor:"Hyun-jun Jung",Role:"Son",urlImage:"https://github.com/javiersgdtu/javiersgvisual/blob/master/assets/img/characters-scale/Da%20Song.png?raw=true",Color:"rgb(166,206,227)",id:"Da_Song"},{Character:"Moon Gwang",Family:"Geun Se",Description:null,Actor:"Jeong-eun Lee",Role:"First Housekeeper",urlImage:"https://github.com/javiersgdtu/javiersgvisual/blob/master/assets/img/characters-scale/Moon%20Gwang.jpg?raw=true",Color:"rgb(51,160,44)",id:"Moon_Gwang"},{Character:"Geun Se",Family:"Geun Se",Description:null,Actor:"Myeong-hoon Park",Role:"First Housekeeper's husband",urlImage:"https://github.com/javiersgdtu/javiersgvisual/blob/master/assets/img/characters-scale/Geun%20Se.png?raw=true",Color:"rgb(178,223,138)",id:"Geun_Se"},{Character:"First chaufer",Family:null,Description:null,Actor:null,Role:null,urlImage:'" "',Color:"#917e0d",id:"Firstchaufer"},{Character:"Party attendants",Family:null,Description:null,Actor:null,Role:null,urlImage:'" "',Color:"#f2d213",id:"Partyattendants"}];function textmouseOver(t){var e=("#"+d3.select(t).style("--match")).replace(/\s/g,"");d3.select(t).transition().duration(700).style("font-size","27px"),svg.select(e).raise().transition().duration(1e3).ease(d3.easeLinear).attr("fill",(function(t,e){return t.urlImage?"url(#"+t.id+")":"#FEB100"})).attr("r",4*radius).attr("stroke",(function(t){return colorCharacter(t.Character)})).attr("stroke-width",15).attr("stroke-dasharray",10)}function textmouseOut(t){var e=("#"+d3.select(t).style("--match")).replace(/\s/g,"");d3.select(t).transition().duration(500).style("font-size","19px"),svg.select(e).transition().duration(1e3).attr("fill",(function(t){return colorCharacter(t.Character)})).attr("r",radius).attr("stroke-width",0)}function handleMouseOverTextRoom(t){var e=("#"+d3.select(t).style("--match")).replace(/\s/g,"");d3.select(t).transition().duration(700).style("font-size","27px"),d3.select(e).transition().duration(500).style("stroke-width","10px").style("opacity",1),d3.select("#area").remove();var a=d3.select(e).select("title"),s=d3.select(e.parentNode).select("title");d3.select("#house-svg").append("text").attr("id","area").text((function(t){return null==s.text().match("Stairs|Intercom|Kitchen")?a.text():s.text()})).attr("x",d3.select("#house-svg").attr("width")/4+50).attr("y",100)}function handleMouseOutTextRoom(t){var e=("#"+d3.select(t).style("--match")).replace(/\s/g,"");d3.select(t).transition().duration(500).style("font-size","19px");var a=d3.select(e).attr("checkbox");d3.select(e).transition().duration(500).style("stroke-width","0.5px").style("opacity",(function(){return 1==a?1:.5})),d3.select(e.parentNode).select("title"),d3.select("#area").remove()}function textmouseOverAid(){d3.select("#area").remove(),d3.select("#con-kitchen2basement").selectAll("path").transition().duration(500).style("stroke-width","10px").style("opacity",1),d3.select("#con-kitchen2basement").selectAll("polygon").transition().duration(1e3).style("opacity",1),d3.select("#house-svg").append("text").attr("id","area").text((function(){return d3.select("#con-kitchen2basement").select("title").text()})).attr("text-anchor","middle").attr("x",posX+100).attr("y",100)}function textmouseOutAid(){d3.select("#con-kitchen2basement").selectAll("path").transition().duration(500).style("stroke-width","0.5px").style("opacity",.5),d3.select("#con-kitchen2basement").selectAll("polygon").transition().duration(1e3).style("opacity",0),d3.select("#area").remove()}function handleCheck(t){var e="true"==t.getAttribute("checkedStory")&&t.checked;d3.selectAll(".checkbox-housemap").property("checked",!1),1==e?(d3.select(".text-legend").style("visibility","hidden"),d3.select(".character-circles").style("visibility","hidden"),d3.select(".force").style("visibility","hidden"),d3.json("data/data_out/house-ocupation.json?v=2.0").then((function(t){var e=[0,100];svg.select("#house-heat").empty()&&function(a,s){var r,o=90,n=900,i=598.79,c=d3.scaleLinear().domain(e).range([0,i]),l=d3.select(".container-svg").select("svg"),u=l.append("g").attr("id","house-heat").attr("transform",`translate(${n}, ${o})`),h=u.append("text").attr("id","labelleft").attr("x",0).attr("y",50),d=u.append("text").attr("id","labelright").attr("x",0).attr("y",50),m=(u.append("rect").attr("width",i).attr("height",30).attr("fill","none").attr("stroke","black"),u.append("text").attr("x",1200-n).attr("y",70-o).text("LOCATIONS").attr("font-family","parasite").attr("font-size",20),d3.brushX().extent([[0,0],[i,30]]).on("brush",(function(a){d3.selectAll(".checkbox-housemap").property("checked",!1);var s=a.selection,o=+Math.round(c.invert(s[0])),n=+Math.round(c.invert(s[1]));e=[o,n],h.attr("x",s[0]).text(o),d.attr("x",s[1]).text(n),x.attr("display",null).attr("transform",(function(t,e){return"translate("+[s[e],-7.5]+")"})),l.node().value=s.map((function(t){return+c.invert(t).toFixed(2)})),l.node().dispatchEvent(new CustomEvent("input")),data_filt=t.filter((function(t){return t.end_seconds_norm>=o&t.end_seconds_norm<=n})),r=[];var i=d3.sum(data_filt,(function(t){return t.dt_sub_sl}));d3.rollup(data_filt,(function(t){return d3.sum(t,(function(t){return t.dt_sub_sl}))/i}),t=>t.sublocation).forEach((function(t,e,a){r.push({sublocation:e,opacity_value:t,percentage:Math.round(100*t)})})),r.sort((function(t,e){return d3.descending(t.opacity_value,e.opacity_value)})),function(t){var e=d3.max(t,(function(t){return t.opacity_value})),a=d3.scaleLinear([.2,1]).domain([0,e]),s={};t.forEach((function(t){s[t.sublocation]=t}));var r=d3.select("#house-color").selectAll("path").filter((function(){return null==d3.select(this).attr("id").match("path")}));r.style("opacity",0),r.filter((function(){return!!s[this.id]})).style("opacity",(function(){return a(s[this.id].opacity_value)})),d3.select("#house-color").selectAll("#entrance-stairs,#entrance-stairs_garage").style("opacity",0),d3.select("#house-color").selectAll("#entrance-stairs,#entrance-stairs_garage").filter((function(){return!!s[this.id]})).style("opacity",(function(){return a(s[this.id].opacity_value)}))}(r),function(t){var a=t.filter((function(t){return t.percentage>10}));svg.select("#info_text").remove();var s=0==e[0]&&100==e[1]?"Across the film:":"In the selected Range:";svg.append("g").attr("id","info_text").append("text").attr("x",20).attr("y",600).text(s).style("font-size","34px"),svg.select("#info_text").append("g").selectAll("text").data(a).enter().append("text").attr("x",20).attr("y",(function(t,e){return 20*e+650})).attr("fill",(function(t){return d3.select("#"+t.sublocation).empty()?"black":d3.select("#"+t.sublocation).style("fill")})).text((function(t){return(d3.select("#"+t.sublocation).empty()?"black":d3.select("#"+t.sublocation).select("title").text())+" "+t.percentage+" %"})).style("font-size",(function(t,e){return 1.5*t.percentage}))}(r)}))),p=u.append("g").attr("class","brush").call(m),x=p.selectAll(".handle--custom").data([{type:"w"},{type:"e"}]).enter().append("path").attr("class","handle--custom").attr("stroke","#000").attr("fill","#eee").attr("cursor","ew-resize").attr("d",(function(t){var e=+("e"==t.type),a=e?1:-1;return"M"+.5*a+",15A6,6 0 0 "+e+" "+6.5*a+",21V24A6,6 0 0 "+e+" "+.5*a+",30ZM"+2.5*a+",23V22M"+4.5*a+",23V22"}));p.selectAll(".overlay").each((function(t){t.type="selection"})).on("mousedown touchstart",(function(t,e){var a=c(1)-c(0),s=t.pageX,r=s-a/2,o=s+a/2;d3.select(this.parentNode).call(m.move,o>i?[i-a,i]:r<0?[0,a]:[r,o])})),p.call(m.move,e.map(c)),l.node()}()}))):(d3.select("#house-heat").remove(),d3.select("#info_text").remove(),d3.selectAll("#entrance-stairs_garage,#entrance-stairs").style("opacity",1),d3.selectAll("path").style("opacity",.5),d3.select(".text-legend").style("visibility","visible"),d3.select(".character-circles").style("visibility","visible"),d3.select(".force").style("visibility","visible"))}function forceCharacters(t){var e=[];d3.json("data/data_out/scenes.json").then((function(a){var s=[...new Set(a.map(t=>t.scene))],r=[...new Set(a.map(t=>t.dt_sub))];a=a.map((function(t,e){return{scene:t.scene,character:t.character,location:t.sublocation,radius:t.difference/10,difference:t.difference,formattime:d(t.difference),action:t.Movement}}));var o=d3.scaleLog([5,30]).domain(d3.extent(a,(function(t){return t.radius}))).domain(d3.extent(a,(function(t){return t.difference}))),n=d3.forceSimulation(a).force("charge",d3.forceManyBody().strength(25)).force("x",d3.forceX().x((function(t){return d3.select("#center-"+t.location).attr("cx")}))).force("y",d3.forceY().y((function(t){return d3.select("#center-"+t.location).attr("cy")}))).force("collision",d3.forceCollide().radius((function(t){return o(t.difference)}))).on("tick",(function(){node.attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y}))}));node=svg.select(".force").empty()?svg.append("g").attr("class","force").selectAll(".node"):node,e=a;var i=widthLong/2/s.length/2,c=d3.scaleLinear().domain(d3.extent(r)).range([i,4*i]),l=0,u=(legend=svg.select("#legend-force").empty()?svg.append("g").attr("id","legend-force"):legend).selectAll("rect").data(r).enter().append("rect").attr("id",(t,e)=>"rect"+e).attr("class","rect-scene").attr("x",(function(t,e){var a=l;return l=c(t)+a+5,900+a})).attr("y",90).attr("width",(function(t){return c(t)})).attr("height",30).attr("fill","#FEB100").on("click",(function(t,e){var a=u.nodes().indexOf(this);d3.selectAll(".rect-scene").attr("fill","#FEB100"),d3.select(this).attr("fill","#670398"),h(a),function(t){svg.select("#info_text").remove(),svg.append("foreignObject").attr("id","info_text").attr("width",400).attr("height",500).attr("x",20).attr("y",540).append("xhtml:span").html(textmouseover[t])}(a)})).on("mouseover",(function(){d3.select(this).style("cursor","pointer")}));function h(t){e=a.filter((function(e){return e.scene==t+3})),(node=node.data(e,(function(t){return t.id}))).exit().transition().attr("r",0).remove(),node=node.enter().append("circle").attr("fill",(function(t){return colorCharacter(t.character)})).call((function(t){t.transition().attr("r",(function(t){return o(t.difference)}))})).merge(node).on("mouseover",(function(t,e){d3.select(this).attr("fill","#FEB100");var a=d3.pointer(t);tooltip.html("<p style='text-align:center;margin:2px'><b>Character:</b> "+e.character+"</p><b>Location:</b> "+d3.select("#center-"+e.location).attr(":inkscape:label")+". </br><b>Duration in Location</b>: "+e.formattime+"</br><b>Action:</b> "+e.action).transition().duration(200).style("visibility","visible").style("opacity",.9).style("left",a[0]+"px").style("top",a[1]+"px")})).on("mouseout",(function(t,e){d3.select(this).attr("fill",colorCharacter(e.character)),tooltip.transition().duration(200).style("visibility","hidden")})),n.nodes(e),n.alpha(1).restart()}function d(t){if(t>=60){var e=Math.floor(t/60);return e+" min "+(t-60*e)+" s."}return t+" s."}t?(d3.selectAll(".rect-scene").attr("fill","#FEB100"),d3.select("#rect"+(t-1)).attr("fill","#670398"),h(t-1)):(l=0,svg.select("#legend-force").append("g").attr("class","text-legend").selectAll("text").data(r).enter().append("text").attr("x",(function(t,e){var a=l;return l=c(t)+a+5,900+a+c(t)/2})).attr("y",140).text((t,e)=>e+1).attr("font-size",15),svg.select(".text-legend").append("text").attr("x",1200).attr("y",70).text("SCENES").attr("font-family","parasite").attr("font-size",20))}))}forceCharacters();var radius=20,palette=(svg=d3.select(".container-svg").select("svg"),Characters.map((function(t){return t.Color}))),characters=Characters.map((function(t){return t.Character})),colorCharacter=d3.scaleOrdinal(palette).domain(characters),characters_leg=Characters.filter((function(t){return"First chaufer"!=t.Character&"Party attendants"!=t.Character}));svg.append("g").selectAll("defs").data(characters_leg).enter().append("pattern").attr("id",(function(t){return t.urlImage?t.id:""})).attr("width","100%").attr("height","100%").attr("viewBox","0 0 1 1").attr("preserveAspectRatio","xMidYMid slice").append("image").attr("width","1").attr("height","1").attr("preserveAspectRatio","xMidYMid slice").attr("xlink:href",(function(t){return t.urlImage}));var j=0,circles=svg.append("g").attr("class","character-circles").selectAll("circle").data(characters_leg).enter().append("circle").attr("id",t=>t.Character.replace(/\s/g,"").replace(/[.]/g,"")).attr("r",radius).attr("cx",(function(t,e){return t.cx=e>=8?e-8:e<=3?e:e-4,1300+t.cx*radius*2.5})).attr("cy",(function(t,e){return t.cy=e>=8?2:e<=3?0:1,240+t.cy*radius*2.5})).attr("fill",(function(t){return colorCharacter(t.Character)})).on("mouseover",(function(t,e){d3.select(this).raise().transition().duration(1e3).ease(d3.easeLinear).attr("fill",(function(t,e){return t.urlImage?"url(#"+t.id+")":"#FEB100"})).attr("r",4*radius).attr("stroke",(function(t){return colorCharacter(t.Character)})).attr("stroke-width",15).attr("stroke-dasharray",10),tooltip.html("<b>Character:</b> "+e.Character+"</br><b>Family:</b> "+e.Family+" </br><b>Role:</b> "+e.Role+" </br><b>Actor:</b> "+e.Actor).transition().duration(200).style("visibility","visible").style("opacity",.9).style("left",1300+4*e.cx+"px").style("top",300+e.cy*radius*2.5+"px")})).on("mouseout",(function(t,e){d3.select(this).transition().duration(1e3).attr("fill",(function(t){return colorCharacter(t.Character)})).attr("r",radius).attr("stroke-width",0),tooltip.transition().duration(200).style("visibility","hidden")}));svg.select(".character-circles").append("text").attr("x",1320).attr("y",200).text("CHARACTERS").attr("font-family","parasite").attr("font-size",20);scroller_heat=scrollama();var slidename="fm_occupancy";function drawHeatMap(t){scroller_heat.setup({step:".step-insights",offset:.5,debug:!1}).onStepEnter((function(t){0==t.index&&"down"==t.direction||1==t.index&&"up"==t.direction?x("fm_occupancy"):3==t.index?x("fm_updown"):4==t.index?x("fm_static"):5==t.index&&x("fm_move")})),new Set(t.map(t=>t.scene)),new Set(t.map(t=>t.dt_sub));var e=d3.select("#heatmap-svg").append("g").attr("transform","translate(160,50)");e.append("g").attr("id","characters-bar");var a=e.append("image").attr("x",550).attr("y",1250).attr("transform","rotate(-30) scale(0.4)").attr("href","images/touch.svg"),s=t.filter((function(t){return t.slide==slidename})),r=s.map((function(t){return t.level})),o=d3.scaleBand([0,500]).domain(["Park","Kim","Geun Se & Moon Gwang"]),n=d3.scaleBand([250,0]).domain(r),i=d3.scaleLinear(["#f7e8ff","#db3535"]).domain([0,100]),c=d3.axisBottom(o),l=d3.axisLeft(n);e.append("g").attr("id","axisY").call(l).call(t=>t.select(".domain").remove()),e.append("g").attr("id","axisX").attr("transform","translate(0,250)").call(c).call(t=>t.select(".domain").remove());var u=e.append("defs").append("linearGradient").attr("id","gradient-legend");u.attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"),u.append("stop").attr("offset","0%").attr("stop-color","#db3535"),u.append("stop").attr("offset","100%").attr("stop-color","#f7e8ff");var h=e.append("g").attr("id","heatmap"),d=o.bandwidth(),m=n.bandwidth();h.append("g").attr("id","legend").append("rect").attr("x",540).attr("y",150).attr("width",20).attr("height",100).style("stroke-width",4).style("stroke","none").style("opacity",.8).attr("fill","url(#gradient-legend)"),h.select("#legend").append("text").attr("x",565).attr("y",150).text("100 %"),h.select("#legend").append("text").attr("x",565).attr("y",250).text("0 %");var p=h.append("g").attr("class","character-heatmap").selectAll("circle").data(characters_leg).enter().append("circle").attr("r",radius).attr("cx",(function(t,e){return t.idx=e,e>=4&&e<=7?(offsetfam=0,t.idx=e-4):e>=0&&e<=3?(offsetfam=40,t.idx=e+4):e>7&&(offsetfam=80),offsetfam+40*t.idx})).attr("cy",(function(){return 310})).attr("fill",(function(t,e){return colorCharacter(t.Character)}));function x(c){s=t.filter((function(t){return t.slide==c})),r=s.map((function(t){return t.level})),n.domain(r),m=n.bandwidth(),e.selectAll("#g-rect").remove(),e.selectAll(".text-heat").remove(),e.selectAll("[id^=g-rect-ch]").remove(),e.selectAll("[id^=g-text-ch]").remove(),e.selectAll("#axisY").transition().duration(500).call(l).call(t=>t.select(".domain").remove()),h.append("g").attr("id","g-rect").selectAll("rect").data(s).enter().append("rect").attr("id",(t,e)=>"rect-"+t.family.substring(0,3)+e).attr("class","rect-heat").attr("x",(function(t){return o(t.family)})).attr("y",t=>n(t.level)).attr("width",d).attr("height",m).attr("rx",10).attr("ry",10).style("stroke-width",4).style("stroke","none").style("opacity",0).attr("fill",(function(t){return i(t.pct)})).on("mouseover",(function(){d3.select(this).raise().transition("tr-rect-heat-in").duration(1e3).style("stroke","black").style("opacity",1),d3.select("#text-"+d3.select(this).attr("id")).transition().duration(500).attr("opacity",1)})).on("mouseout",(function(){d3.select("#text-"+d3.select(this).attr("id")).transition().duration(500).attr("opacity",0),d3.select(this).transition("tr-rect-heat-out").duration(1e3).style("stroke","none")})),h.selectAll(".rect-heat").transition().ease(d3.easeBounce).delay((function(t,e){return 100*e})).duration(1e3).style("opacity",.9),h.append("g").attr("class","text-heat").selectAll("text").data(s).enter().append("text").attr("id",(t,e)=>"text-rect-"+t.family.substring(0,3)+e).attr("x",(function(t){return o(t.family)+d/2-10})).attr("y",t=>n(t.level)+m/2).text((function(t){return t.pct+" %"})).style("font-size","26px").attr("opacity",0).style("pointer-events","none"),p.on("mouseover",(function(s,r){a.transition().duration(2e3).style("visibility","hidden"),d3.select(this).transition().duration(1e3).ease(d3.easeLinear).attr("r",2*radius).attr("stroke",d3.select(this).attr("fill")).attr("stroke-width",15).attr("stroke-dasharray",10).style("z-index",100),h.append("g").attr("id","character-legendheat").attr("transform","translate(-20,55)").append("text").attr("x",d3.select(this).attr("cx")).attr("y",d3.select(this).attr("cy")).text(r.Character),function(a){var s=a.Family.substring(0,3);e.selectAll("[id^='rect-"+s+"']").transition().style("opacity",0);var r=t.filter((function(t){return t.slide=="ch_"+c.substr(3)&&t.family.match(s)})),i=[...new Set(r.map(t=>t.character))],l=d3.scaleBand([0,m]).domain(i).padding(.1),u=d3.scaleLinear([0,d-60]).domain([0,100]);e.select("#characters-bar").selectAll("#g-rect-ch"+s).empty()&&e.select("#characters-bar").append("g").attr("id","g-rect-ch"+s).selectAll("rect").data(r).enter().append("rect").attr("id",(t,e)=>t.character+t.level).attr("x",(function(t){return o(t.family)+5})).attr("y",(function(t,e){return n(t.level)+l(t.character)})).attr("height",(function(t){return l.bandwidth()})).attr("width",(function(t){return u(0)})).attr("fill",t=>colorCharacter(t.character)).attr("rx",5).attr("opacity",.8).transition().duration(1e3).attr("width",(function(t){return u(t.pct)})),e.select("#characters-bar").selectAll("#g-text-ch"+s).empty()&&e.select("#characters-bar").append("g").attr("id","g-text-ch"+s).selectAll("text").data(r).enter().append("text").attr("id",(t,e)=>"text"+t.character+t.level).attr("x",(function(t){return o(t.family)+u(0)+6})).attr("y",(function(t,e){var a=l.bandwidth()>20?l.bandwidth()/1.5:l.bandwidth();return n(t.level)+l(t.character)+a})).text(t=>t.pct+"%").transition().duration(1e3).attr("x",(function(t){return o(t.family)+u(t.pct)+6}))}(r),e.selectAll("[id^='"+r.Character+"']").attr("stroke","black").attr("stroke-dasharray",4).attr("opacity",1)})).on("mouseout",(function(t,a){var s=a.Family.substring(0,3);e.selectAll("[id^='rect-"+s+"']").transition().duration(500).style("opacity",1),d3.select("#character-legendheat").remove(),d3.select(this).transition().duration(1e3).attr("r",radius).attr("stroke-width",0),e.selectAll("[id^='"+a.Character+"']").attr("stroke","none").attr("opacity",.9)}))}}d3.json("data/data_out/heatmap.json").then((function(t){drawHeatMap(t)}));