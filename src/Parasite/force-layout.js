var nodes,svg=d3.select("svg"),width=svg.attr("width")/2,height=svg.attr("height")/2,formatMinute=d3.format(".0f"),currentValue=0,moving=!1,n=20,m=3;maxRadius=12,xCenter=[100,300,500];var playButton=d3.select("#play-button");function handleMouseOver(){d3.select(this).transition().duration(500).style("stroke-width","10px").style("opacity",1),d3.select("#area").remove(),d3.select("svg").append("text").attr("id","area").text(d3.select(this).attr("id")).attr("x",d3.select("svg").attr("width")/4+50).attr("y",100)}function handleMouseOut(){d3.select(this).transition().duration(500).style("stroke-width","0.5px").style("opacity",.5),d3.select("#area").remove()}function step(){update(xScale.invert(currentValue)),(currentValue+=width/151)>width&&(moving=!1,currentValue=0,clearInterval(timer),playButton.text("Play"))}function update(t){var e=formatMinute(t);label.attr("x",xScale(t)).text(e),drawPlot(circles.filter((function(t){return e==t.minute?t.character:""})))}function drawPlot(t){nodes=t.map((function(t){return t={cluster:t.location,radius:t.radius}})),d3.forceSimulation(nodes).force("center",d3.forceCenter(width/2,height/2)).force("collision",d3.forceCollide().radius((function(t){return t.radius}))).force("x",d3.forceX().x((function(t){return xCenter[t.cluster]}))).on("tick",ticked)}function ticked(){var t=d3.select("svg").selectAll("circle").data(nodes);t.enter().append("circle").attr("r",(function(t){return t.radius})).merge(t).attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})),t.exit().remove()}d3.json("circles-v2.json").then((function(t){var e=d3.scaleLinear().domain(d3.extent(t,(function(t){return t.scene_lenght}))).range([0,width]).clamp(!0),r=svg.append("g").attr("class","slider").attr("transform","translate(50,100)");r.selectAll("line").data(t).enter().append("line").attr("class","track").attr("x1",e(d.scene_lenght)).attr("x2",e.range()[1]).select((function(){return this.parentNode.appendChild(this.cloneNode(!0))})).attr("class","track-inset").select((function(){return this.parentNode.appendChild(this.cloneNode(!0))})).attr("class","track-overlay").call(d3.drag().on("start.interrupt",(function(){r.interrupt()})).on("start drag",(function(t){currentValue=t.x,update(e.invert(currentValue))}))),r.insert("g",".track-overlay").attr("class","ticks").attr("transform","translate(0,18)").selectAll("text").data(e.ticks(10)).enter().append("text").attr("x",e).attr("text-anchor","middle").text((function(t){return t})),r.append("text").attr("class","label").attr("text-anchor","middle").text(0).attr("transform","translate(0,-25)"),circles=t,circles.forEach((function(t,e){t.radius=5+e})),playButton.on("click",(function(){var t=d3.select(this);"Pause"==t.text()?(moving=!1,clearInterval(timer),t.text("Play")):(moving=!0,timer=setInterval(step,100),t.text("Pause"))}))})),d3.selectAll("path").style("opacity",.5).on("mouseover",handleMouseOver).on("mouseout",handleMouseOut);