function handleCheck(t){var e="true"==t.getAttribute("checkedStory")&&t.checked;d3.selectAll(".checkbox-housemap").property("checked",!1),1==e?(d3.select(".text-legend").style("visibility","hidden"),d3.select(".character-circles").style("visibility","hidden"),d3.select(".force").style("visibility","hidden"),d3.json("data/data_out/house-ocupation.json?v=2.0").then((function(t){var e=[0,100];function a(t){var a=t.filter((function(t){return t.percentage>10}));svg.select("#info_text").remove();var n=0==e[0]&&100==e[1]?"Across the film:":"In the selected Range:";svg.append("g").attr("id","info_text").append("text").attr("x",20).attr("y",600).text(n).style("font-size","34px"),svg.select("#info_text").append("g").selectAll("text").data(a).enter().append("text").attr("x",20).attr("y",(function(t,e){return 20*e+650})).attr("fill",(function(t){return d3.select("#"+t.sublocation).empty()?"black":d3.select("#"+t.sublocation).style("fill")})).text((function(t){return(d3.select("#"+t.sublocation).empty()?"black":d3.select("#"+t.sublocation).select("title").text())+" "+t.percentage+" %"})).style("font-size",(function(t,e){return 1.5*t.percentage}))}svg.select("#house-heat").empty()&&function(n,r){var l,i={top:90,bottom:135,left:900,right:40},s=598.79,c=30,o=d3.scaleLinear().domain(e).range([0,s]),d=d3.select(".container-svg").select("svg"),u=d.append("g").attr("id","house-heat").attr("transform",`translate(${i.left}, ${i.top})`),p=u.append("text").attr("id","labelleft").attr("x",0).attr("y",50),f=u.append("text").attr("id","labelright").attr("x",0).attr("y",50),h=(u.append("rect").attr("width",s).attr("height",c).attr("fill","none").attr("stroke","black"),u.append("text").attr("x",1200-i.left).attr("y",70-i.top).text("LOCATIONS").attr("font-family","parasite").attr("font-size",20),d3.brushX().extent([[0,0],[s,c]]).on("brush",(function(n){d3.selectAll(".checkbox-housemap").property("checked",!1);var r=n.selection,i=+Math.round(o.invert(r[0])),s=+Math.round(o.invert(r[1]));e=[i,s],p.attr("x",r[0]).text(i),f.attr("x",r[1]).text(s),v.attr("display",null).attr("transform",(function(t,e){return"translate("+[r[e],-7.5]+")"})),d.node().value=r.map((function(t){return+o.invert(t).toFixed(2)})),d.node().dispatchEvent(new CustomEvent("input")),data_filt=t.filter((function(t){return t.end_seconds_norm>=i&t.end_seconds_norm<=s})),l=[];var c=d3.sum(data_filt,(function(t){return t.dt_sub_sl}));d3.rollup(data_filt,(function(t){return d3.sum(t,(function(t){return t.dt_sub_sl}))/c}),t=>t.sublocation).forEach((function(t,e,a){l.push({sublocation:e,opacity_value:t,percentage:Math.round(100*t)})})),l.sort((function(t,e){return d3.descending(t.opacity_value,e.opacity_value)})),function(t){var e=d3.max(t,(function(t){return t.opacity_value})),a=d3.scaleLinear([.2,1]).domain([0,e]),n={};t.forEach((function(t){n[t.sublocation]=t}));var r=d3.select("#house-color").selectAll("path").filter((function(){return null==d3.select(this).attr("id").match("path")}));r.style("opacity",0),r.filter((function(){return!!n[this.id]})).style("opacity",(function(){return a(n[this.id].opacity_value)})),d3.select("#house-color").selectAll("#entrance-stairs,#entrance-stairs_garage").style("opacity",0),d3.select("#house-color").selectAll("#entrance-stairs,#entrance-stairs_garage").filter((function(){return!!n[this.id]})).style("opacity",(function(){return a(n[this.id].opacity_value)}))}(l),a(l)}))),y=u.append("g").attr("class","brush").call(h),v=y.selectAll(".handle--custom").data([{type:"w"},{type:"e"}]).enter().append("path").attr("class","handle--custom").attr("stroke","#000").attr("fill","#eee").attr("cursor","ew-resize").attr("d",(function(t){var e=+("e"==t.type),a=e?1:-1;return"M"+.5*a+",15A6,6 0 0 "+e+" "+6.5*a+",21V24A6,6 0 0 "+e+" "+.5*a+",30ZM"+2.5*a+",23V22M"+4.5*a+",23V22"}));y.selectAll(".overlay").each((function(t){t.type="selection"})).on("mousedown touchstart",(function(t,e){var a=o(1)-o(0),n=t.pageX,r=n-a/2,l=n+a/2;d3.select(this.parentNode).call(h.move,l>s?[s-a,s]:r<0?[0,a]:[r,l])})),y.call(h.move,e.map(o)),d.node()}()}))):(d3.select("#house-heat").remove(),d3.select("#info_text").remove(),d3.selectAll("#entrance-stairs_garage,#entrance-stairs").style("opacity",1),d3.selectAll("path").style("opacity",.5),d3.select(".text-legend").style("visibility","visible"),d3.select(".character-circles").style("visibility","visible"),d3.select(".force").style("visibility","visible"))}