var node,legend;function forceCharacters(t){var e=[];d3.json("data/data_out/scenes.json").then((function(n){var r=[...new Set(n.map(t=>t.scene))],a=[...new Set(n.map(t=>t.dt_sub))];d3.sum(a),n=n.map((function(t,e){return{scene:t.scene,character:t.character,location:t.sublocation,radius:t.difference/10,difference:t.difference,formattime:u(t.difference),action:t.Movement}}));var c=d3.scaleLog([5,30]).domain(d3.extent(n,(function(t){return t.difference}))),o=d3.forceSimulation(n).force("charge",d3.forceManyBody().strength(25)).force("x",d3.forceX().x((function(t){return d3.select("#center-"+t.location).attr("cx")}))).force("y",d3.forceY().y((function(t){return d3.select("#center-"+t.location).attr("cy")}))).force("collision",d3.forceCollide().radius((function(t){return c(t.difference)}))).on("tick",(function(){node.attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y}))}));node=svg.select(".force").empty()?svg.append("g").attr("class","force").selectAll(".node"):node,e=n;var i=widthLong/2/r.length/2,l=d3.scaleLinear().domain(d3.extent(a)).range([i,4*i]),s=0,d=(legend=svg.select("#legend-force").empty()?svg.append("g").attr("id","legend-force"):legend).selectAll("rect").data(a).enter().append("rect").attr("id",(t,e)=>"rect"+e).attr("class","rect-scene").attr("x",(function(t,e){var n=s;return s=l(t)+n+5,900+n})).attr("y",90).attr("width",(function(t){return l(t)})).attr("height",30).attr("fill","orange").on("click",(function(t,e){var n=d.nodes().indexOf(this);d3.selectAll(".rect-scene").attr("fill","orange"),d3.select(this).attr("fill","#670398"),f(n),function(t){svg.select("#info_text").remove(),svg.append("foreignObject").attr("id","info_text").attr("width",400).attr("height",500).attr("x",20).attr("y",540).append("xhtml:span").html(textmouseover[t])}(n)})).on("mouseover",(function(){d3.select(this).style("cursor","pointer")}));function f(t){e=n.filter((function(e){return e.scene==t+3})),(node=node.data(e,(function(t){return t.id}))).exit().transition().attr("r",0).remove(),node=node.enter().append("circle").attr("fill",(function(t){return colorCharacter(t.character)})).call((function(t){t.transition().attr("r",(function(t){return c(t.difference)}))})).merge(node).on("mouseover",(function(t,e){d3.select(this).attr("fill","orange");var n=d3.pointer(t);tooltip.html("<p style='text-align:center;margin:2px'><b>Character:</b> "+e.character+"</p><b>Location:</b> "+d3.select("#center-"+e.location).attr(":inkscape:label")+". </br><b>Duration in Location</b>: "+e.formattime+"</br><b>Action:</b> "+e.action).transition().duration(200).style("visibility","visible").style("opacity",.9).style("left",n[0]+"px").style("top",n[1]+"px")})).on("mouseout",(function(t,e){d3.select(this).attr("fill",colorCharacter(e.character)),tooltip.transition().duration(200).style("visibility","hidden")})),o.nodes(e),o.alpha(1).restart()}function u(t){if(t>=60){var e=Math.floor(t/60);return e+" min "+(t-60*e)+" s."}return t+" s."}t?(d3.selectAll(".rect-scene").attr("fill","orange"),d3.select("#rect"+(t-1)).attr("fill","#670398"),f(t-1)):(s=0,svg.select("#legend-force").append("g").attr("class","text-legend").selectAll("text").data(a).enter().append("text").attr("x",(function(t,e){var n=s;return s=l(t)+n+5,900+n+l(t)/2})).attr("y",140).text((t,e)=>e+1).attr("font-size",15),svg.select(".text-legend").append("text").attr("x",1200).attr("y",70).text("SCENES").attr("font-family","parasite").attr("font-size",20))}))}forceCharacters();